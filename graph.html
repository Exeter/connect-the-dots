<html>
<head>
<title>Graph visualization</title>
<style type="text/css">
body {
	margin: 0px;
}
.graph {
	background-color: #252726;
}
.nodetext{
	color: #fff;
}

.edge {
	stroke: #999;
	stroke-opacity: .2;
}
</style>
</head>
<body>
<script src="./d3.v3.min.js"></script>
<script>
var w = document.body.clientWidth;
var h  = document.body.clientHeight;

var force = d3.layout.force()
	.gravity(10)
	.charge(-50)
	.linkDistance(10)
	.size([w, h]);

var svg = d3.select('body').append('svg')
	.attr("class", 'graph')
	.attr("width", w)
	.attr("height", h);

d3.json("./data/d3_graph.json", function( err, data){
	if (err) return console.warn(err);
	//data.students = data.students.slice(0,100);
	//data.edges = data.edges.slice(0,10000);

	force
		.nodes(data.students)
		.links(data.edges)
		.start();

	var edge = svg.selectAll('.edge')
		.data(data.edges)
		.enter().append('line')
		.attr('class', 'edge')
		.style('stroke-width', 1);
	var node = svg.selectAll('.node')
		.data(data.students)
		.enter().append('circle')
		.attr('class', 'node')
		.attr('r', 5)
		.style('fill', function(d){
			color = {
				'9': '#efefef',
				'10': '#94e76b',
				'11': '#ffac18',
				'12': '#e32c57'
			}
			return color[d.Grade];
		})
		.call(force.drag);
	node.append("title")
		.text(function(d) {return d.UserName});
	node.append("svg:text")
		.attr("class", "nodetext")
		.attr("dy", -3)
		.text(function(d) {return d.UserName});

	force.on('tick', function(){
		edge.attr('x1', function(d) { return d.source.x; })
			.attr('y1', function(d) { return d.source.y; })
			.attr("x2", function(d) { return d.target.x; })
			.attr("y2", function(d) { return d.target.y; });
		node.attr('cx', function(d) { return d.x; })
			.attr("cy", function(d) { return d.y; });
	});

});
</script>
</body>
</html>
